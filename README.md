<p align="center">
<img src="https://imgur.com/QsNl5x2.png" alt="osTicket logo"/>
</p>

<h1> Azure Sentiel (SIEM) Map Connected To a HoneyPot </h1>

This walkthrough demonstrates the setup of Azure Sentinel (SIEM) which will be connected to a virtual machine that is configured to act as a vulnerable honeypot. The Azure Sentinel SIEM will be displayed as a world map where an RDP brute force attack can be observed attacking the VM from around the world. This walkthrough uses a pre-written Powershell script that will collect the attacker's longitude and latitude location to be able to display the location on the Sentinel map.<br />

<h2>Environments and Technologies Used</h2>

- Microsoft Azure (Virtual Machines/Compute)
- Remote Desktop
- Command Line/Windows Powershell
- Azure Sentinel
- Azure Log Analytics Workspace

<h2>Operating Systems Used </h2>

- Windows 10</b> (version 22H2)

<h2>List of Prerequisites</h2>

- Windows Powershell
- Azure Sentinel
- Remote Desktop

<h2> Installation Steps</h2>


<p>
<img src = "https://imgur.com/LYWGrDr.png" " height="80%" width="80%" alt="Disk Sanitization Steps"/>
</p>

<p>
<img src = "https://imgur.com/jd0C1z7.png" " height="80%" width="80%" alt="Disk Sanitization Steps"/>
</p>
 <p>
1. Create the Azure virtual machine. This VM will act as the honeypot.
</p>                                                                                                    
                                                                                                     


<p>
   
 <p>
<img src= "https://imgur.com/9sr6kJ9.png" " height="80%" width="80%" alt="Disk Sanitization Steps" />
</p>
                                                                                                 
                                                                                                 
2. When creating the VM, under the "Network" section, create a new inbound rule to allow in all traffic from the internet.
</p>
<br />

<p>
<img src="https://imgur.com/E26am1V.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
</p>



<p>
3. Create a Log Analytics Workspace in Microsoft Azure. Proceed to enable log-gathering for the workspace.
</p>
<br />

<p>
<img src="https://imgur.com/QYmU7sm.png" width="80%" alt="Disk Sanitization Steps"/>
</p>

<p>
<img src="https://imgur.com/yGvgq6Y.png" width="80%" alt="Disk Sanitization Steps"/>
</p>



<p>
4. Connect the Log Analytics Workspace to the VM.
</p>
<br />

<p>
<img src="https://imgur.com/pnbEDHR.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
</p>
<p>
5. Set up Azure Sentinel. 
</p>
<br />

<p>
<img src="https://imgur.com/MKlN9Nb.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
</p>
<p>
6. Since Azure Sentinel is going to collect the failed logins to the VM, we can start off by conducting a fake failed login to the VM so we can have some data displayed on the final map. If we look inside the Event Viewer for the VM, we can see how there is a failed login that was generated by our attempt.

                                                                                                 
7.  Proceed to RDP into the VM and disable all firewall settings to make the VM vulnerable.
</p>
<br />



</p>
<br />

8. In the VM, copy and paste this Powershell script into the prompt. This Powershell Script will be able to collect the geo-location of the attacks and send them to Azure Sentinel. Before running the script, obtain a Geo-Location API key. Copy and paste the API key into the correct area. Proceed to run the script.

</p>
<br />

<p>
<img src="https://imgur.com/D2XNsJD.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
</p>

<p>
9. A custom log can now be created in Azure Log Analysis Workspace. Copy and paste in the following code to extract the right fields from the log data.

</p>


<p>
<img src="https://imgur.com/ZCmNnTF.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
</p>


<p>
10. Create a workbook in Azure Sentinel. Place the following code in the query line and run the command.
</p>
<br />

<p>
<img src="https://imgur.com/JNPV4Q6.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
</p>


<p>
11. Observe the Powershell Script in the VM. Each time an attacker fails to RDP into the VM, the purple text will show the attacker's geo-location and what username they used to attempt to log in to the VM.
</p>
<br />

<p>
<img src="https://imgur.com/Fovz2uM.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
</p>


<p>
<img src="https://imgur.com/DEudDmw.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
</p>


<p> 12. Now observe the Sentinel SIEM map. Every failed login is depicted as a dot wherever the attacker is located on the world map. The dot will appear as a darker color if a lot of traffic is coming from a specific region.

